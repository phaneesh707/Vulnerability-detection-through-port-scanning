import socket
from IPy import IP
import threading
localport = 0


def openport_scanner(port):
    try:

        my_ip_address = socket.gethostbyname(
            socket.gethostname())  # get user IP address

        # my_ip_address = "142.250.193.100"

        # initialize socket
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        # set a connection timeout
        s.settimeout(0.5)

        # connect to the IP address port number
        s.connect((my_ip_address, port))
        try:
            service = s.recv(1024).decode()  # get the open port banner(if any)
            print(f"Port {port} is open[+] using service {service}")
        except:
            print(f"Port {port} is open [+]")
            global localport
            if(port == 3000 or port == 4000 or port == 3001):
                localport = port
    except:
        pass


for port in range(1, 5000):
    thread = threading.Thread(target=openport_scanner, args=[port])
    thread.start()

ports = []
banners = []
# print(ports)


def port_scanner(target, port):
    try:
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.settimeout(5)

        try:
            target_ip = IP(target)  # check if target is an IP address
        except:
            # check if the target is a domain name or locahost
            target_ip = socket.gethostbyname(target)

        s.connect((target_ip, port))
        try:
            # get banner name
            banner_name = banner(s).decode()
            ports.append(port)

            # store banner_name in banners list
            banners.append(banner_name.strip())
        except:

            pass
    except:
        pass

# print(ports)


def banner(s):
    return s.recv(1024)


target = input(
    "Enter Target IP address, localhost or domain name eg www.eg.com: ")

for port in range(1, 10051):
    thread = threading.Thread(target=port_scanner, args=[target, port])
    thread.start()

with open("vulnarable_banners.txt", "r") as file:
    data = file.read()
    for i in range(len(banners)):
        if banners[i] in data:
            print(f"[!]Vulneribility found: {banners[i]} at port {ports[i]}")
    print(localport)
    if(localport != 0):
        print("[!]Vulneribility found: cross site scripting at port ", localport)
    else:
        print("No Vulneribility found,ports are safe")
